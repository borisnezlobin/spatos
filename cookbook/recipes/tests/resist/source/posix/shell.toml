name = "Portable Operating System Interface - Shell and Utilities"
desc = "POSIX.1-2017: https://pubs.opengroup.org/onlinepubs/9699919799/"

#TODO: alias, ar, at, awk (not on Redox)

[tests.basename]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/basename.html"
source = """
basename /usr/bin
basename /usr/bin in
"""
output = """
bin
b
"""

#TODO: batch, bc (not on Redox)

[tests.cat]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/cat.html"
source = """
echo two > 2
echo one > 1
cat 1 2
"""
output = """
one
two
"""

#TODO: cd, chgrp, chmod, chown, cksum (predictable output)

[tests.cmp]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/cmp.html"
source = """
echo one > 1
echo two > 2
cmp 1 1
cmp 2 2
cmp 1 2 || true
"""
output = """
1 2 differ: byte 1, line 1
"""

#TODO: comm (complicated)

[tests.command]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/command.html"
source = """
command -V echo
"""
output = """
echo is a shell builtin
"""

[tests.cp]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/cp.html"
source = """
echo two > 2
echo one > 1
cp 1 3
cp 2 4
cat 3 4
"""
output = """
one
two
"""

#TODO: crontab, csplit (not on Redox)

[tests.cut]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/cut.html"
source = """
echo a,b,c,d,e,f,g | cut -d , -f 2,4,6
"""
output = """
b,d,f
"""

#TODO: date (uutils version is odd)

[tests.dd]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/dd.html"
source = """
echo one > 1
dd if=1 of=2 bs=1 count=2 2>/dev/null
cat 2
"""
output = "on"

#TODO: df (format is different on Redox)
#TODO: diff (install diffutils on Redox)


[tests.dirname]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/dirname.html"
source = """
dirname /usr/bin
"""
output = """
/usr
"""

[tests.du]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/du.html"
source = """
dd if=/dev/zero of=1 bs=1024 count=256 2>/dev/null
du 1
"""
output = """
256\t1
"""

[tests.echo]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/echo.html"
source = """
echo a b c d
"""
output = """
a b c d
"""

#TODO: ed (the standard editor)

[tests.env]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/env.html"
source = """
env KEY=VALUE printenv KEY
"""
output = """
VALUE
"""

#TODO: ex (interactive program)

[tests.expand]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/expand.html"
source = """
echo "test\texpand" | expand
"""
output = """
test    expand
"""

[tests.expr]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/expr.html"
source = """
expr 2 + 2
"""
output = """
4
"""

[tests.false]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/false.html"
source = """
false && echo TRUE || echo FALSE
"""
output = """
FALSE
"""

#TODO: fc, fg, file (not on Redox)

[tests.find]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/find.html"
source = """
echo one > 1
echo two > 2
find .
find . -name 2
find . -name 1
"""
output = """
.
./1
./2
./2
./1
"""

[tests.fold]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/fold.html"
source = """
echo abcdefghijklmnopqrstuvwxyz | fold -w 3
"""
output = """
abc
def
ghi
jkl
mno
pqr
stu
vwx
yz
"""

#TODO: fuser, gencat, getconf, getopts (not on Redox)

[tests.grep]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/grep.html"
source = """
echo one > 1
echo two >> 1
echo three >> 1
grep two 1
grep -v three 1
"""
output = """
two
one
two
"""

[tests.hash]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/hash.html"
source = """
hash sh
"""
output = """
"""

[tests.head]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/head.html"
source = """
echo one > 1
echo two >> 1
echo three >> 1
head -n 1 1
head -n -1 1
head -n 2 1
head -n -2 1
"""
output = """
one
one
two
one
two
one
"""

#TODO: iconv (evil, use UTF-8!)
#TODO: id (predictable output)
#TODO: ipcrm, ipcs (not on Redox)
#TODO: jobs (predictable output)
#TODO: join (complicated)

[tests.kill]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/kill.html"
source = """
sleep 60&
KILL_PID="$!"
kill -2 "$KILL_PID"
wait "$KILL_PID" || echo "$?"
"""
output = """
130
"""

#TODO: lex (not on Redox)
#TODO: link (not implemented on Redox)

[tests.ln]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/ln.html"
source = """
echo one > 1
ln -s 1 2
cat 2
"""
output = """
one
"""

#TODO: locale, localedef, logger, logname, lp (evil, not on Redox)

[tests.ls]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/ls.html"
source = """
echo one > 1
echo two > 2
ls -1a
"""
output = """
.
..
1
2
"""

#TODO: m4 (evil, not on Redox)

[tests.make]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/make.html"
source = """
echo "1:" > Makefile
echo "\techo one > 1" >> Makefile
make 1
cat 1
"""
output = """
echo one > 1
one
"""

#TODO: man (interactive)
#TODO: mesg (not on Redox)

[tests.mkdir]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/mkdir.html"
source = """
mkdir directory
cd directory
basename "${PWD}"
"""
output = """
directory
"""

#TODO: mkfifo (not on Redox)
#TODO: more (interactive)

[tests.mv]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/mv.html"
source = """
echo one > 1
echo two > 2
mv 1 2
ls -1
cat 2
"""
output = """
2
one
"""

#TODO: newgrp, nice (not on Redox)

[tests.nl]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/nl.html"
source = """
echo one > 1
echo two >> 1
echo three >> 1
nl 1
"""
output = """
     1	one
     2	two
     3	three
"""

#TODO: nm (predictable output)
#TODO: nohup (not on Redox)

[tests.od]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/od.html"
source = """
echo abcdefghijklmnopqrstuvwxyz > 1
od -t x1 1
"""
output = """
0000000 61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f 70
0000020 71 72 73 74 75 76 77 78 79 7a 0a
0000033
"""

#TODO: paste (complicated)
#TODO: patch (install diffutils on Redox)
#TODO: pathchk (not on Redox)
#TODO: pr (not on Redox)

[tests.printf]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/printf.html"
source = """
printf 'printf %d %.1f %c %s\\n' 1 2.0 c str
"""
output = """
printf 1 2.0 c str
"""

#TODO: ps (predictable output)
#TODO: pwd (predictable output)

[tests.read]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/read.html"
source = """
echo one > 1
echo two >> 1
cat 1 | while read line
do
    echo "line: $line"
done
"""
output = """
line: one
line: two
"""

#TOOD: renice (not on Redox)

[tests.rm]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/rm.html"
source = """
touch 1 2 3 4
ls -1
rm 1 2
ls -1
rm 4
ls -1
"""
output = """
1
2
3
4
3
4
3
"""

[tests.rmdir]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/rmdir.html"
source = """
mkdir 1 2 3 4
ls -1
rmdir 1 2
ls -1
rmdir 4
ls -1
"""
output = """
1
2
3
4
3
4
3
"""

#TODO: sed (install on Redox)
#TODO: sh (isn't this already tested enough)
#TODO: sleep (needs a reliable way to measure time)

[tests.sort]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/sort.html"
source = """
for c in z y x w v u t s r q p o n m l k j i h g f e d c b a
do
    echo "${c}" >> 1
done
sort 1
"""
output = """
a
b
c
d
e
f
g
h
i
j
k
l
m
n
o
p
q
r
s
t
u
v
w
x
y
z
"""

#TODO: split (complicated)
#TODO: strings, strip (predictable output)
#TODO: stty, tabs (not on Redox)

[tests.tail]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/tail.html"
source = """
echo one > 1
echo two >> 1
echo three >> 1
tail -n 1 1
tail -n +1 1
tail -n 2 1
tail -n +2 1
"""
output = """
three
one
two
three
two
three
two
three
"""

[tests.tee]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/tee.html"
source = """
echo one | tee 1
echo two >> 1
echo three | tee -a 1
cat 1
"""
output = """
one
three
one
two
three
"""

[tests.test]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/test.html"
source = """
mkdir directory
touch file
touch script
chmod +x script
test -d directory -a ! -d file
test -f file -a ! -f directory
test -x script -a ! -x file
"""
output = ""

#TODO: time (predictable output)

[tests.touch]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/touch.html"
source = """
touch 1 2 3
ls -1
"""
output = """
1
2
3
"""

#TODO: tput (not on Redox)

[tests.tr]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/tr.html"
source = """
echo abcdefghijklmnopqrstuvwxyz | tr a b | tr s b | tr -d z | tr -s b
"""
output = """
bcdefghijklmnopqrbtuvwxy
"""

[tests.true]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/true.html"
source = """
true && echo TRUE || echo FALSE
"""
output = """
TRUE
"""

#TODO: inconsistent output and errors out on Redox
# [tests.tsort]
# desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/tsort.html"
# source = """
# echo "a b c c d e" > 1
# echo "g g" >> 1
# echo "f g e f" >> 1
# echo "h h" >> 1
# tsort 1
# """
# output = """
# a
# c
# d
# h
# b
# e
# f
# g
# """

#TODO: tty (not on Redox)

[tests.type]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/type.html"
source = """
type echo
"""
output = """
echo is a shell builtin
"""

#TODO: ulimit (not on Redox)

[tests.umask]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/umask.html"
source = """
UMASK="$(umask)"
umask 0000
umask
umask 0777
umask
umask "${UMASK}"
"""
output = """
0000
0777
"""

#TODO: unalias
#uname is tested elsewhere

[tests.unexpand]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/unexpand.html"
source = """
echo "         test unexpand" | unexpand
"""
output = """
\t test unexpand
"""

[tests.uniq]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/uniq.html"
source = """
echo one > 1
echo two >> 1
echo two >> 1
echo two >> 1
echo three >> 1
echo three >> 1
echo four >> 1
echo five >> 1
echo five >> 1
echo four >> 1
echo three >> 1
echo two >> 1
echo one >> 1
echo one >> 1
uniq 1
"""
output = """
one
two
three
four
five
four
three
two
one
"""

#TODO: unlink, uudecode, uuencode (not on Redox)
#TODO: vi (the only program you will ever need, interactive)

[tests.wait]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/wait.html"
source = """
true&
WAIT_PID="$!"
wait "$WAIT_PID" && echo "$?"
false&
WAIT_PID="$!"
wait "$WAIT_PID" || echo "$?"
"""
output = """
0
1
"""

[tests.wc]
desc = "https://pubs.opengroup.org/onlinepubs/9699919799/utilities/wc.html"
source = """
echo abcdefghijklmnopqrstuvwxyz | wc -c
echo one two three four | wc -w
echo line | wc -l
"""
output = """
27
4
1
"""

#TODO: who, write, xargs, yacc, zcat (not on Redox)
